{% extends "base_backend.html" %}
{% load crispy_forms_filters %}

{% block content %}
<div class="page-header">
    <h2>
        {{ area.name }}<br/>
        <small>Planificación {{ year }}</small>
    </h2>
</div>
{% url 'plan_area_selector' as backurl %}
<form method="post">
    {% csrf_token %}
    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th class="col-md-7">Destino</th>
                {% for r in width_range %}
                <th class="col-md-1 text-center" colspan="2">{{ year|add:r }}</th>
                {% endfor %}
                <th class="col-md-2"></th>
            </tr>
        </thead>
        <tbody>
        {% for row in grid %}
            <tr {% if forloop.last %}style="font-weight:bold"{% endif %}>
            {% if forloop.last or row.destination.status %}
                <td>{{ row.destination }}</td>
                {% else %}
                <td><s>{{ row.destination }}</s></td>
                {% endif %}
                {% for inner_year in row.data %}
                <td class="text-right">
                    {{ inner_year.plan|floatformat:2 }}<br/>
                    <small>{{ inner_year.book|floatformat:2 }}</small>
                </td>
                <td>
                    <b class="label label-{% if inner_year.book_percent > 100 %}danger{% elif inner_year.book_percent == 0 %}info{% elif inner_year.book_percent < 90 %}warning{% else %}success{% endif %}">
                        {{ inner_year.book_percent|floatformat:0 }}%
                    </b>
                </td>
                {% if not forloop.parentloop.last and forloop.last %}
                <td>
                    <input class="form-control" type="number" name="{{ row.destination.code }}" value="{{ inner_year.plan|safe }}">
                </td>
                {% endif %}
            {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    
    <hr/>
    <button type="submit" class="btn btn-primary">Guardar planificación</button>
    <a href="{{ request.GET.volver|default:backurl }}" class="btn btn-default">No hacer cambios en la planificación</a>
</form>
{% endblock content %}